<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Korrothal</title>
  <link rel="stylesheet" href="../stylesheet.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    .notes textarea {
      width: 100%;
      height: 250px;
      background-color: #1A1A1D;
      color: #E0D8B0;
      border: 1px solid #3A3A3F;
      border-radius: 5px;
      padding: 15px;
      font-family: 'Merriweather', serif;
      font-size: 1em;
      resize: vertical;
    }

    header {
      background-color: #1A1A1D;
      color: gold;
      padding: 15px;
      text-align: center;
    }

    header ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    header li {
      display: inline;
      margin: 0 15px;
    }

    header a {
      color: gold;
      text-decoration: none;
      font-weight: bold;
    }

    header a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>The Ardent Empire</h1>
    <nav>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../players.html">Player Characters</a></li>
        <li><a href="../cities.html">Locations</a></li>
        <li><a href="../map/map.html">Map</a></li>
      </ul>
    </nav>
  </header>

  <div class="city-banner">
    <h1>Korrothal</h1>
    <p><em>The Great Bridge</em></p>
  </div>

  <div class="city-content">
    <div class="section">
      <h2>Lore</h2>
      <p>Korrothal is not a city of trade, but a city that *serves* trade. It exists for one purpose: to guard and maintain the <strong>Grand Ardent Bridge</strong>, a massive stone span crossing the otherwise impassable <strong>Sebral's Passage</strong>. This deep gulf carves a great ravine through the land, and this bridge is the only safe crossing for a hundred miles, making it the vital chokepoint for goods traveling inland.</p>
      
      <p><strong>History & Governance:</strong> The town was built at the same time as the bridge, a massive Imperial project to secure the inland trade route. It is a strategic military outpost, governed by an Imperial <strong>Bridge-Warden</strong>, a military title granted by the regional governor. The Warden's word is law, and their sole mandate is to keep the bridge open and the tolls collected.</p>
      
      <p><strong>Geography & Economy:</strong> The town is built on the "near" side of the passage. Its economy is straightforward: it runs on the <strong>tolls</strong> collected from every wagon and traveler, and on servicing the caravans that must often wait days to cross. The town is filled with inns, stables, wheelwrights, and mercenaries hiring on as caravan guards.</p>
      
      <p><strong>Culture & Factions:</strong> The culture of Korrothal is pragmatic, transient, and wary. Everyone is either a soldier, a merchant just passing through, or someone looking to make coin off the travelers. The two main factions are the <strong>Bridge Garrison</strong> (the official soldiers) and the <strong>Teamsters' Guild</strong>, a powerful collective of merchants and wagon-drivers that often negotiates with the Warden over toll fees.</p>
    </div>

    <div class="section">
      <h2>City Districts</h2>
      
      <h3>The Toll-Gate</h3>
      <p>The main district, a fortified barbican built directly into the mouth of the Grand Ardent Bridge. This massive, grim structure is where tolls are assessed and collected. It is heavily garrisoned at all times, with murder holes, arrow slits, and massive iron portcullises that can seal the bridge in moments. The <strong>Bridge-Warden's Keep</strong> is built directly above this gatehouse.</p>

      <h3>The Caravan Court</h3>
      <p>A sprawling, muddy, and chaotic district just outside the Toll-Gate. This is a massive, open-air staging ground for caravans. It is surrounded by a ring of inns, taverns, stables, and warehouses. Caravans and their guards spend their time here, resupplying, repairing wagons, and waiting for their turn to be called for crossing.</p>

      <h3>The Garrison</h3>
      <p>A stark, functional district set just uphill from the Toll-Gate. This area contains the barracks, training grounds, and armory for the Bridge Garrison. It is orderly, disciplined, and separate from the chaos of the Caravan Court. Off-duty soldiers are a common sight in the city's inns, but they rarely mix with the locals.</p>

      <h3>The Underspan</h3>
      <p>A rough, precarious settlement clinging to the cliffs *below* the main town, accessible by steep stairs and rope ladders. This is where the bridge's laborers, stone-masons, and poorer workers live. It also has a reputation as a black market, a place where one can hire smugglers who use ropes and pulleys to bypass the Toll-Gate... for a steep price.</p>
    </div>
    
    <div class="section">
      <h2>Key NPCs</h2>
      <div class="npc">
        <strong>Bridge-Warden Kyra</strong> — A stern, no-nonsense military veteran given charge of Korrothal. She is incorruptible and sees the bridge as a sacred Imperial trust. She cares only for order and the steady collection of tolls.
      </div>
      <div class="npc">
        <strong>"Toll-Taker" Ormag</strong> — The civilian Master of the Tolls, a bloated and bureaucratic man who works for the Warden. He is rumored to be the one to see if a caravan needs to "expedite" its crossing, and he has a network of spies in the Caravan Court.
      </div>
      <div class.npc>
        <strong>Innkeeper Malda</strong> — The proprietor of "The Broken Wheel," the largest and most popular inn in the Caravan Court. She has seen and heard everything that passes along the trade route and is a valuable source of information.
      </div>
    </div>

    <div class="section dm-screen">
      <h2>DM Screen (Secrets)</h2>
      <button id="dmButton">Show DM Notes</button>

      <div id="dmNotesContainer" style="display:none; background-color:#1a1a1d; border:1px solid gold; padding:15px; margin-top:10px; color:#E0D8B0;">
          <pre id="dmNotesContent" style="white-space: pre-wrap; font-family: 'Merriweather', serif;"></pre>
      </div>

      <div id="encryptedData" style="display:none;">U2FsdGVkX1+WsjNeNQOUrBeRdp1/1L+GwJ+1bA/aMR9QKOcU5S6COaCqy0IFRL5c</div>
    </div>

    <div class="section notes">
      <h2>Player Notes</h2>
      <textarea id="notes" placeholder="Write notes here..."></textarea>
      <button id="saveNotes">Save Notes</button>
    </div>

    <a href="../map/map.html" class="back-link">⬅ Back to Campaign Map</a>
  </div>

  <script>

          // START: ADD THIS DECRYPTION LOGIC
  const dmButton = document.getElementById('dmButton');

  dmButton.addEventListener('click', () => {
    const password = prompt('Enter DM Password:');
    if (!password) return;

    const encryptedText = document.getElementById('encryptedData').innerText;
    if (!encryptedText.trim()) {
        alert('No encrypted notes found on this page.');
        return;
    }

    try {
        // Try to decrypt
        const bytes = CryptoJS.AES.decrypt(encryptedText, password);
        const decryptedNotes = bytes.toString(CryptoJS.enc.Utf8);

        if (decryptedNotes) {
            // Success!
            document.getElementById('dmNotesContent').innerText = decryptedNotes;
            document.getElementById('dmNotesContainer').style.display = 'block';
            dmButton.style.display = 'none'; // Hide button
        } else {
            // Password was wrong, but didn't cause an error
            alert('Wrong Password!');
        }
    } catch (e) {
        // Password was definitely wrong and caused an error
        alert('Wrong Password!');
        console.error(e);
    }
  });
  // END: ADD THIS DECRYPTION LOGIC


    const notesKey = 'korrothal_notes';
    const textarea = document.getElementById('notes');
    const saveButton = document.getElementById('saveNotes');

    textarea.value = localStorage.getItem(notesKey) || '';

    saveButton.addEventListener('click', () => {
      localStorage.setItem(notesKey, textarea.value);
      alert('Notes saved!');
    });
  </script>
</body>
</html>